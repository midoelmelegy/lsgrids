<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>24h PnL</title>
<style>
  html,body{height:100%;margin:0}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#fff;font-family:-apple-system,BlinkMacSystemFont,
    "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
  }
  #pnl{
    font-size:clamp(72px,18vw,220px); /* Extra large, adaptive */
    font-weight:800; letter-spacing:1px;
    line-height:1; user-select:none;
  }
  .pos{ color:#12b886; } /* Green */
  .neg{ color:#ef4444; } /* Red */
  .muted{ color:#111; } /* Default boldface */
</style>
</head>
<body>
  <div id="pnl" class="muted">Loading…</div>

<script>
const VAULT = "0x07fd993f0fa3a185f7207adccd29f7a87404689d";
const API = "https://api.hyperliquid.xyz/info";
const EL = document.getElementById("pnl");

function toNum(x){
  // Convert all possible strings/numbers with commas to Number
  if (x == null) return NaN;
  if (typeof x === "number") return x;
  if (typeof x === "string") return Number(x.replace(/,/g,"").trim());
  return Number(x);
}

function renderNumber(n){
  // Add a plus sign to positive numbers; display integers (remove decimals), thousands place.
  const int = Math.trunc(n); // If you want pure numbers, you can change it to Math.round/Math.floor
  const sign = int > 0 ? "+" : ""; // Negative numbers are included by default -
  const text = `${sign}${int.toLocaleString("en-US", {
  style: "currency",
  currency: "USD"
})}`;


  EL.textContent = text;
  EL.classList.remove("pos","neg","muted");
  EL.classList.add(int >= 0 ? "pos" : "neg");
}

async function fetchPnL24h(){
  try{
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "vaultDetails", vaultAddress: VAULT }),
    });
    const data = await res.json();

    // Extract from portfolio → "day" → pnlHistory //
    // Portfolio format: [ ["day",{ pnlHistory: [[t,v],[t,v],...] }], ["week",{...}], ... ]
    const portfolio = Array.isArray(data?.portfolio) ? data.portfolio : [];
    const dayEntry = portfolio.find(it => Array.isArray(it) && it[0] === "day");
    const dayBlock = dayEntry && dayEntry[1] ? dayEntry[1] : {};
    const series = Array.isArray(dayBlock?.pnlHistory) ? dayBlock.pnlHistory : [];

    if (series.length >= 2){
      const first = toNum(series[0][1]);
      const last  = toNum(series[series.length - 1][1]);
      const pnl24h = last - first;

      if (Number.isFinite(pnl24h)){
        renderNumber(pnl24h);
        return;
      }
    }

    // Backup: If the structure changes/cannot be retrieved, provide an observable hint.
    EL.textContent = "Data error";
    EL.classList.remove("pos","neg");
    EL.classList.add("muted");
    // Opening the output will allow you to see the original structure in the console, making troubleshooting easier.
    // console.log("Raw data:", data);

  }catch(err){
    EL.textContent = "Loading failed";
    EL.classList.remove("pos","neg");
    EL.classList.add("muted");
    // console.error(err);
  }
}

// Load immediately, then refresh every 120 seconds
fetchPnL24h();
setInterval(fetchPnL24h, 120000);
</script>
</body>
</html>
