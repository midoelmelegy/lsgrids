<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>24h PnL</title>
<style>
  html,body{height:100%;margin:0}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#fff;font-family:-apple-system,BlinkMacSystemFont,
    "Segoe UI","Roboto","Helvetica Neue",Arial,sans-serif;
  }
  #pnl{
    font-size:clamp(72px,18vw,220px); /* 超大，自适应 */
    font-weight:800; letter-spacing:1px;
    line-height:1; user-select:none;
  }
  .pos{ color:#12b886; }   /* 绿 */
  .neg{ color:#ef4444; }   /* 红 */
  .muted{ color:#111; }    /* 默认黑体 */
</style>
</head>
<body>
  <div id="pnl" class="muted">加载中…</div>

<script>
const VAULT = "0xdfc24b077bc1425ad1dea75bcb6f8158e10df303";
const API = "https://api.hyperliquid.xyz/info";
const EL = document.getElementById("pnl");

function toNum(x){
  // 把可能的字符串/带逗号数字都转成 Number
  if (x == null) return NaN;
  if (typeof x === "number") return x;
  if (typeof x === "string") return Number(x.replace(/,/g,"").trim());
  return Number(x);
}

function renderNumber(n){
  // 正数加 + 号；整数显示（去小数），千分位
  const int = Math.trunc(n); // 你要纯数字可改成 Math.round/Math.floor
  const sign = int > 0 ? "+" : ""; // 负数自带 -
  const text = `${sign}¥${int.toLocaleString("zh-CN")}`;

  EL.textContent = text;
  EL.classList.remove("pos","neg","muted");
  EL.classList.add(int >= 0 ? "pos" : "neg");
}

async function fetchPnL24h(){
  try{
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "vaultDetails", vaultAddress: VAULT }),
    });
    const data = await res.json();

    // —— 从 portfolio → "day" → pnlHistory 提取 —— 
    // portfolio 形如：[ ["day",{ pnlHistory: [[t,v],[t,v],...] }], ["week",{...}], ... ]
    const portfolio = Array.isArray(data?.portfolio) ? data.portfolio : [];
    const dayEntry = portfolio.find(it => Array.isArray(it) && it[0] === "day");
    const dayBlock = dayEntry && dayEntry[1] ? dayEntry[1] : {};
    const series = Array.isArray(dayBlock?.pnlHistory) ? dayBlock.pnlHistory : [];

    if (series.length >= 2){
      const first = toNum(series[0][1]);
      const last  = toNum(series[series.length - 1][1]);
      const pnl24h = last - first;

      if (Number.isFinite(pnl24h)){
        renderNumber(pnl24h);
        return;
      }
    }

    // 兜底：如果结构变化/取不到，给出可观察的提示
    EL.textContent = "数据错误";
    EL.classList.remove("pos","neg");
    EL.classList.add("muted");
    // 打开下行可在控制台看到原始结构，便于排查
    // console.log("Raw data:", data);

  }catch(err){
    EL.textContent = "加载失败";
    EL.classList.remove("pos","neg");
    EL.classList.add("muted");
    // console.error(err);
  }
}

// 立即加载一次，然后每 120 秒刷新
fetchPnL24h();
setInterval(fetchPnL24h, 120000);
</script>
</body>
</html>
